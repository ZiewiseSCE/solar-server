<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>태양광 발전사업 종합 분석 리포트</title>
    
    <!-- 파비콘 추가 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>☀️</text></svg>">

    <!-- 스타일 및 아이콘 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- 차트 라이브러리 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; -webkit-print-color-adjust: exact; }
            .shadow-2xl { box-shadow: none !important; border: 1px solid #e2e8f0; }
            .bg-slate-200 { background-color: white !important; }
        }
    </style>
</head>
<body class="bg-slate-200 p-8 min-h-screen">
    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden">
        
        <!-- 1. 리포트 헤더 -->
        <div class="bg-slate-900 text-white p-8 flex justify-between items-end print:bg-slate-900">
            <div>
                <div class="flex items-center gap-2 text-yellow-400 mb-1">
                    <i class="ph-fill ph-sun text-2xl"></i>
                    <span class="text-xs font-bold tracking-widest uppercase">SolarCloud Enterprise</span>
                </div>
                <h1 class="text-3xl font-bold tracking-tight">태양광 발전사업 타당성 분석</h1>
                <p class="text-slate-400 text-sm mt-2">AI 기반 입지 규제 및 PF 금융 분석 리포트</p>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold mb-1">{{ data.address }}</div>
                <div class="text-sm text-slate-400 flex items-center justify-end gap-1">
                    <i class="ph ph-calendar-blank"></i> 분석일자: {{ data.date }}
                </div>
            </div>
        </div>

        <div class="p-8 space-y-10">
            
            <!-- 2. 핵심 지표 요약 (Dashboard) -->
            <section>
                <h2 class="text-lg font-bold text-slate-800 border-b-2 border-slate-800 pb-3 mb-6 flex items-center gap-2">
                    <i class="ph-fill ph-chart-polar text-blue-600 text-xl"></i> 1. 핵심 사업 지표
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- 카드 1 -->
                    <div class="bg-blue-50 p-5 rounded-xl border border-blue-100 flex flex-col items-center justify-center">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-2"><i class="ph-fill ph-lightning text-xl"></i></div>
                        <div class="text-xs text-slate-500 font-bold uppercase">설비 용량</div>
                        <div class="text-xl font-bold text-slate-800 mt-1">{{ data.capacity }}</div>
                    </div>
                    <!-- 카드 2 -->
                    <div class="bg-emerald-50 p-5 rounded-xl border border-emerald-100 flex flex-col items-center justify-center">
                        <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 mb-2"><i class="ph-fill ph-money text-xl"></i></div>
                        <div class="text-xs text-slate-500 font-bold uppercase">총 사업비</div>
                        <div class="text-xl font-bold text-slate-800 mt-1" id="dispTotalCost">{{ data.finance.totalCost }}</div>
                    </div>
                    <!-- 카드 3 -->
                    <div class="bg-amber-50 p-5 rounded-xl border border-amber-100 flex flex-col items-center justify-center">
                        <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 mb-2"><i class="ph-fill ph-trend-up text-xl"></i></div>
                        <div class="text-xs text-slate-500 font-bold uppercase">연간 예상 수익</div>
                        <div class="text-xl font-bold text-slate-800 mt-1" id="dispAnnualRev">{{ data.finance.annualRev }}</div>
                    </div>
                    <!-- 카드 4 -->
                    <div class="bg-indigo-50 p-5 rounded-xl border border-indigo-100 flex flex-col items-center justify-center">
                        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 mb-2"><i class="ph-fill ph-hourglass-high text-xl"></i></div>
                        <div class="text-xs text-slate-500 font-bold uppercase">자본 회수 기간</div>
                        <div class="text-xl font-bold text-slate-800 mt-1">{{ data.finance.payback }}</div>
                    </div>
                </div>
            </section>

            <!-- 3. PF 금융 분석 & 차트 -->
            <section>
                <h2 class="text-lg font-bold text-slate-800 border-b-2 border-slate-800 pb-3 mb-6 flex items-center gap-2">
                    <i class="ph-fill ph-bank text-indigo-600 text-xl"></i> 2. PF 금융 및 수익성 분석
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 왼쪽: 상세 테이블 -->
                    <div class="space-y-4">
                        <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
                            <div class="bg-slate-50 px-4 py-3 border-b border-slate-200 flex justify-between items-center">
                                <span class="font-bold text-slate-700 text-sm">자금 조달 구조</span>
                            </div>
                            <div class="p-4 space-y-3 text-sm">
                                <div class="flex justify-between border-b border-slate-100 pb-2">
                                    <span class="text-slate-500">PF 대출금</span>
                                    <span class="font-bold text-slate-800" id="dispLoan">{{ data.finance.loan }}</span>
                                </div>
                                <div class="flex justify-between border-b border-slate-100 pb-2">
                                    <span class="text-slate-500">자기자본 (Equity)</span>
                                    <span class="font-bold text-slate-800" id="dispEquity">{{ data.finance.equity }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
                            <div class="bg-slate-50 px-4 py-3 border-b border-slate-200 flex justify-between items-center">
                                <span class="font-bold text-slate-700 text-sm">수지 분석 (연간)</span>
                            </div>
                            <div class="p-4 space-y-3 text-sm">
                                <div class="flex justify-between border-b border-slate-100 pb-2">
                                    <span class="text-slate-500">대출 이자 비용</span>
                                    <span class="font-bold text-red-500">- {{ data.finance.interest }}</span>
                                </div>
                                <div class="flex justify-between pt-1">
                                    <span class="text-slate-500">순수익 (Net Income)</span>
                                    <span class="font-bold text-blue-600">+ {{ data.finance.netIncome }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 오른쪽: 차트 영역 -->
                    <div class="grid grid-cols-1 gap-6">
                         <!-- 자금 조달 차트 -->
                         <div class="bg-white p-4 rounded-lg border border-slate-200 flex flex-col items-center">
                            <h4 class="text-xs font-bold text-slate-500 mb-2 w-full text-left">자금 조달 비율</h4>
                            <div class="h-40 w-full flex justify-center">
                                <canvas id="fundChart"></canvas>
                            </div>
                         </div>
                         <!-- 회수 기간 차트 -->
                         <div class="bg-white p-4 rounded-lg border border-slate-200 flex flex-col items-center">
                             <h4 class="text-xs font-bold text-slate-500 mb-2 w-full text-left">투자비 회수 시뮬레이션 (20년)</h4>
                             <div class="h-40 w-full">
                                 <canvas id="roiChart"></canvas>
                             </div>
                         </div>
                    </div>
                </div>
            </section>

            <!-- 4. 입지 규제 분석 -->
            <section>
                <h2 class="text-lg font-bold text-slate-800 border-b-2 border-slate-800 pb-3 mb-6 flex items-center gap-2">
                    <i class="ph-fill ph-map-trifold text-green-600 text-xl"></i> 3. 입지 규제 및 인허가 검토
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 용도지역 -->
                    <div class="border border-slate-200 rounded-lg p-5 hover:bg-slate-50 transition">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-slate-700 flex items-center gap-2"><i class="ph-fill ph-buildings text-slate-400"></i> 용도지역/지구</span>
                            <span class="text-[10px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-bold">국토계획법</span>
                        </div>
                        <p class="text-lg text-slate-900 font-bold mb-3">{{ data.ai_analysis.zoning }}</p>
                        <a href="https://www.eum.go.kr/web/am/amMain.jsp" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 underline flex items-center gap-1 no-print">토지이음 확인 <i class="ph-bold ph-arrow-square-out"></i></a>
                    </div>

                    <!-- 한전 선로 -->
                    <div class="border border-yellow-300 rounded-lg p-5 bg-yellow-50/50">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-slate-700 flex items-center gap-2"><i class="ph-fill ph-lightning text-yellow-500"></i> 한전 선로 용량</span>
                            <span class="text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded font-bold">필수 확인</span>
                        </div>
                        <p class="text-lg text-slate-900 font-bold mb-3">{{ data.kepco_capacity }}</p>
                        <a href="https://online.kepco.co.kr/" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 underline flex items-center gap-1 no-print">한전ON 바로가기 <i class="ph-bold ph-arrow-square-out"></i></a>
                    </div>

                    <!-- 환경영향평가 -->
                    <div class="border border-slate-200 rounded-lg p-5 hover:bg-slate-50 transition">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-slate-700 flex items-center gap-2"><i class="ph-fill ph-leaf text-green-500"></i> 환경영향평가</span>
                            <span class="text-[10px] bg-green-100 text-green-800 px-2 py-0.5 rounded font-bold">환경부</span>
                        </div>
                        <p class="text-lg text-slate-900 font-bold mb-3">{{ data.ai_analysis.env_assessment }}</p>
                        <a href="https://aid.mcee.go.kr/" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 underline flex items-center gap-1 no-print">환경공간정보서비스 <i class="ph-bold ph-arrow-square-out"></i></a>
                    </div>

                    <!-- 경사도 -->
                    <div class="border border-slate-200 rounded-lg p-5 hover:bg-slate-50 transition">
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-slate-700 flex items-center gap-2"><i class="ph-fill ph-mountains text-slate-400"></i> 개발행위 (경사도)</span>
                            <span class="text-[10px] bg-slate-100 text-slate-600 px-2 py-0.5 rounded font-bold">지자체 조례</span>
                        </div>
                        <p class="text-sm text-slate-600 mb-3 leading-relaxed">지자체별 허가 기준(15~25도)이 상이하므로 정밀 분석이 필요합니다.</p>
                        <a href="https://webgis.neins.go.kr/map.do" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 underline flex items-center gap-1 no-print">국토환경성평가지도 <i class="ph-bold ph-arrow-square-out"></i></a>
                    </div>
                </div>

                <!-- 체크포인트 -->
                <div class="mt-6 bg-slate-50 p-5 rounded-lg border border-slate-200 text-sm text-slate-700">
                    <strong class="block mb-3 flex items-center gap-2 text-slate-900 border-b border-slate-200 pb-2"><i class="ph-fill ph-check-circle text-lg text-green-500"></i> 8대 핵심 확인 사항</strong>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 pl-2">
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>자치법규:</strong> 이격거리 규제 확인 <a href="https://www.elis.go.kr/" target="_blank" class="text-blue-500 underline no-print">[이동]</a></div></li>
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>문화재:</strong> 반경 500m 보호구역 <a href="https://www.nie-ecobank.kr/cmmn/Index.do?" target="_blank" class="text-blue-500 underline no-print">[이동]</a></div></li>
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>일사량:</strong> 평균 일조시간 분석</div></li>
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>민원:</strong> 인근 주민 동의 여부</div></li>
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>진입로:</strong> 공사 차량 진입 가능 여부</div></li>
                        <li class="flex items-start gap-2"><i class="ph-bold ph-check text-green-500 mt-1"></i> <div><strong>배수로:</strong> 우수 처리 계획 수립</div></li>
                    </ul>
                </div>
            </section>

            <div class="text-center text-xs text-slate-400 mt-12 pb-4 border-t border-slate-200 pt-4">
                본 리포트는 AI 예측 결과로 법적 효력이 없으며, 실제 인허가 결과와 다를 수 있습니다.<br>
                정확한 내용은 해당 지자체 및 전문가와 상담하시기 바랍니다.
            </div>
        </div>

        <!-- 하단 버튼 -->
        <div class="bg-white p-6 border-t border-slate-200 flex justify-center gap-4 no-print fixed bottom-0 left-0 w-full shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
            <button onclick="window.print()" class="bg-slate-800 hover:bg-slate-700 text-white px-8 py-3 rounded-lg font-bold flex items-center gap-2 transition shadow-lg">
                <i class="ph-bold ph-printer text-xl"></i> 인쇄 / PDF 저장
            </button>
            <button onclick="window.close()" class="bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-8 py-3 rounded-lg font-bold transition shadow-sm">
                창 닫기
            </button>
        </div>
    </div>

    <script>
        // 숫자 파싱 유틸리티
        function parseMoney(str) {
            if(!str) return 0;
            return parseInt(str.replace(/[^0-9]/g, '')) || 0;
        }

        window.onload = function() {
            // 데이터 가져오기 (문자열 -> 숫자)
            const loan = parseMoney("{{ data.finance.loan }}");
            const equity = parseMoney("{{ data.finance.equity }}");
            const totalCost = parseMoney("{{ data.finance.totalCost }}");
            const annualNetIncome = parseMoney("{{ data.finance.netIncome }}"); // 순수익 사용

            // 1. 자금 조달 차트 (Doughnut)
            const ctx1 = document.getElementById('fundChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['대출금 (PF)', '자기자본'],
                    datasets: [{
                        data: [loan, equity],
                        backgroundColor: ['#3b82f6', '#10b981'], // Blue, Emerald
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                    }
                }
            });

            // 2. 투자 회수 차트 (Bar/Line Combo)
            // 20년간의 누적 수익 계산
            const years = Array.from({length: 20}, (_, i) => i + 1 + '년차');
            const cumulativeIncome = years.map((_, i) => annualNetIncome * (i + 1));
            const costLine = Array(20).fill(totalCost);

            const ctx2 = document.getElementById('roiChart').getContext('2d');
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: '총 투자비 (회수 목표)',
                            data: costLine,
                            borderColor: '#ef4444', // Red
                            borderWidth: 2,
                            pointRadius: 0,
                            borderDash: [5, 5],
                            fill: false
                        },
                        {
                            label: '누적 순수익',
                            data: cumulativeIncome,
                            backgroundColor: '#3b82f6', // Blue
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            type: 'bar'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: false },
                            ticks: { callback: function(value) { return value / 100000000 + '억'; } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 }, maxTicksLimit: 10 }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                    }
                }
            });
        };
    </script>
</body>
</html>
