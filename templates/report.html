<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar Pathfinder ë¦¬í¬íŠ¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    .card { background: rgba(255,255,255,0.95); border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800 font-sans">

  <div class="sticky top-0 z-50 bg-white/80 backdrop-blur border-b border-slate-200 shadow-sm">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold shadow">R</div>
        <h1 class="text-lg font-extrabold text-slate-800">ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <span id="viewModeBadge" class="ml-2 text-xs px-2 py-0.5 rounded bg-slate-200 text-slate-600 font-bold">DETAIL</span>
      </div>
      <div>
        <button id="btnBackToList" class="hidden px-3 py-1.5 text-sm font-bold bg-white border border-slate-300 rounded hover:bg-slate-50 transition" onclick="goListView()">
          <i class="ph-bold ph-list"></i> ëª©ë¡ìœ¼ë¡œ
        </button>
        <button class="px-3 py-1.5 text-sm font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition shadow" onclick="window.print()">
          <i class="ph-bold ph-printer"></i> ì¸ì‡„
        </button>
      </div>
    </div>
  </div>

  <div class="max-w-5xl mx-auto p-4 fade-in">
    
    <div id="listView" class="hidden space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold flex items-center gap-2">
          <i class="ph-fill ph-radar text-indigo-600"></i> ì „ìˆ˜ ìŠ¤ìº” ê²°ê³¼
        </h2>
        <button class="text-sm text-indigo-600 hover:underline" onclick="runBatchAI()">ğŸ”„ ì „ì²´ AI ì¬ë¶„ì„</button>
      </div>

      <div class="overflow-hidden rounded-xl border border-slate-200 shadow-sm bg-white">
        <table class="w-full text-sm text-left">
          <thead class="bg-slate-50 text-slate-500 font-bold border-b">
            <tr>
              <th class="px-4 py-3 w-16 text-center">ìˆœìœ„</th>
              <th class="px-4 py-3">ì£¼ì†Œì§€</th>
              <th class="px-4 py-3 w-24 text-right">ìˆ˜ìµë¥ (IRR)</th>
              <th class="px-4 py-3 w-32 text-center">8ëŒ€ ì²´í¬</th>
              <th class="px-4 py-3 w-24 text-center">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="scanResultTableBody" class="divide-y divide-slate-100">
            <tr class="hover:bg-slate-50 cursor-pointer transition">
              <td class="px-4 py-3 text-center font-mono text-slate-400">1</td>
              <td class="px-4 py-3 font-medium">ë°ì´í„° ë¡œë”© ì¤‘...</td>
              <td class="px-4 py-3 text-right text-orange-600 font-bold">-</td>
              <td class="px-4 py-3 text-center">-</td>
              <td class="px-4 py-3 text-center"><button class="px-2 py-1 bg-white border rounded shadow-sm text-xs">ë³´ê¸°</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="detailView" class="">
      <div class="p-8 text-center text-slate-400 border-2 border-dashed border-slate-300 rounded-xl">
        <p>ì—¬ê¸°ì— ìƒì„¸ ë¦¬í¬íŠ¸ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
        <p class="text-xs mt-2">(report_latest.htmlì˜ ë‚´ìš©ì„ ì´ div ì•ˆì— ë³µì‚¬í•˜ì„¸ìš”)</p>
      </div>
    </div>

  </div>

  <script>
    /* ================= ë·°ì–´ ë¡œì§ ================= */
    
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const viewMode = urlParams.get('view');

        if (viewMode === 'list') {
            showListView();
        } else {
            showDetailView(); // ê¸°ë³¸ê°’
        }
    });

    function showListView() {
        document.getElementById('listView').classList.remove('hidden');
        document.getElementById('detailView').classList.add('hidden');
        document.getElementById('btnBackToList').classList.add('hidden'); // ë¦¬ìŠ¤íŠ¸ì—ì„  ì•ˆë³´ì„
        document.getElementById('viewModeBadge').textContent = "LIST";
        document.getElementById('viewModeBadge').className = "ml-2 text-xs px-2 py-0.5 rounded bg-indigo-100 text-indigo-600 font-bold";
        
        renderScanTable();
    }

    function showDetailView() {
        document.getElementById('listView').classList.add('hidden');
        document.getElementById('detailView').classList.remove('hidden');
        
        // ë¦¬ìŠ¤íŠ¸ì—ì„œ ë“¤ì–´ì˜¨ ê²½ìš°ì—ë§Œ 'ëª©ë¡ìœ¼ë¡œ' ë²„íŠ¼ í‘œì‹œ
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('from') === 'list') {
            document.getElementById('btnBackToList').classList.remove('hidden');
        }
        
        document.getElementById('viewModeBadge').textContent = "DETAIL";
        document.getElementById('viewModeBadge').className = "ml-2 text-xs px-2 py-0.5 rounded bg-orange-100 text-orange-600 font-bold";
    }

    function goListView() {
        // URL ë³€ê²½ ì—†ì´ ë·°ë§Œ ì „í™˜ (SPA ëŠë‚Œ)
        showListView();
        history.pushState(null, '', '?view=list');
    }

    function renderScanTable() {
        const tbody = document.getElementById('scanResultTableBody');
        const rawData = localStorage.getItem('sp_scan_results');
        
        if (!rawData) {
            tbody.innerHTML = `<tr><td colspan="5" class="px-4 py-8 text-center text-slate-400">ì €ì¥ëœ ìŠ¤ìº” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì§€ë„ë¡œ ëŒì•„ê°€ 'ì „ìˆ˜ ìŠ¤ìº”'ì„ ìˆ˜í–‰í•˜ì„¸ìš”.</td></tr>`;
            return;
        }

        const data = JSON.parse(rawData); // Array expected
        tbody.innerHTML = ''; // Clear

        // ì •ë ¬: IRR ë‚´ë¦¼ì°¨ìˆœ
        data.sort((a, b) => (b.irr || 0) - (a.irr || 0));

        data.forEach((item, index) => {
            const tr = document.createElement('tr');
            tr.className = "hover:bg-slate-50 cursor-pointer transition border-b border-slate-100";
            tr.onclick = () => {
                // ìƒì„¸ ë³´ê¸° í´ë¦­ ì‹œ: ë°ì´í„°ë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì„ì‹œ ìŠ¬ë¡¯ì— ë„£ê±°ë‚˜, URLë¡œ ì „ë‹¬
                // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ë·° ì „í™˜ë§Œ ì‹œë®¬ë ˆì´ì…˜
                showDetailView();
                // TODO: item ë°ì´í„°ë¥¼ ìƒì„¸ ë·°ì— ë°”ì¸ë”©í•˜ëŠ” ë¡œì§ í•„ìš” (ê¸°ì¡´ report.htmlì˜ ë¡œì§ í™œìš©)
            };

            // 8ëŒ€ ì²´í¬ ìƒíƒœ íŒë³„ (ì˜ˆì‹œ)
            const checkStatus = item.checks_pass ? 
                `<span class="text-green-600 font-bold text-xs bg-green-100 px-2 py-1 rounded">ì í•©</span>` : 
                `<span class="text-red-600 font-bold text-xs bg-red-100 px-2 py-1 rounded">ì£¼ì˜</span>`;

            tr.innerHTML = `
                <td class="px-4 py-3 text-center font-mono text-slate-500">${index + 1}</td>
                <td class="px-4 py-3 font-medium text-slate-700">${item.address || 'ì£¼ì†Œ ë¯¸ìƒ'}</td>
                <td class="px-4 py-3 text-right text-orange-600 font-extrabold">${item.irr || 0}%</td>
                <td class="px-4 py-3 text-center">${checkStatus}</td>
                <td class="px-4 py-3 text-center"><i class="ph-bold ph-caret-right text-slate-300"></i></td>
            `;
            tbody.appendChild(tr);
        });
    }
  </script>
</body>
</html>
