<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Pathfinder Cloud (Pro)</title>
    
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Pretendard', sans-serif; }
        #map { width: 100%; height: 100%; z-index: 1; background: #1a1a1a; }
        
        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar { z-index: 2000; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar.collapsed { transform: translateX(-100%); }
        
        /* UI ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .result-card { background: rgba(15, 23, 42, 0.95); border-left: 4px solid #06b6d4; backdrop-filter: blur(4px); }
        .selectable-building { cursor: pointer; stroke: #fff; stroke-width: 2; stroke-dasharray: 4; fill: #38bdf8; fill-opacity: 0.2; transition: all 0.2s; }
        .selectable-building:hover { fill-opacity: 0.5; stroke: #06b6d4; stroke-width: 3; }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-radius: 50%; border-top: 3px solid #06b6d4; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
    <div id="sidebar" class="sidebar absolute top-0 left-0 h-full w-[400px] bg-white shadow-2xl flex flex-col border-r border-gray-200">
        
        <!-- í—¤ë” -->
        <div class="p-5 bg-slate-900 text-white shadow-lg shrink-0">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="ph ph-cloud-check text-cyan-400"></i> Solar Pathfinder
            </h1>
            <div class="flex justify-between items-center mt-2">
                <p class="text-[11px] text-slate-400">Backend Connected</p>
                <div class="flex items-center gap-1.5">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] text-green-400 font-bold">LIVE</span>
                </div>
            </div>
        </div>

        <!-- ì»¨í…ì¸  ì˜ì—­ -->
        <div class="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-4">
            
            <!-- ì„¤ì • íŒ¨ë„ -->
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-3">
                <h3 class="text-xs font-bold text-slate-500 flex items-center gap-1 uppercase tracking-wider">
                    <i class="ph ph-sliders-horizontal"></i> ë¶„ì„ ì„¤ì •
                </h3>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold mb-1 block">ëª¨ë“ˆ ì¶œë ¥(W)</label>
                        <input type="number" id="modPower" value="640" class="w-full bg-slate-50 border border-slate-200 rounded p-1.5 text-center font-bold text-sm focus:border-cyan-500 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold mb-1 block">ì´ê²© ê±°ë¦¬(m)</label>
                        <input type="number" id="rowSpacing" value="1.0" step="0.1" class="w-full bg-slate-50 border border-slate-200 rounded p-1.5 text-center font-bold text-sm focus:border-cyan-500 outline-none">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 pt-2 border-t border-slate-100">
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold mb-1 block">SMP(ì›)</label>
                        <input type="number" id="smp" value="180" class="w-full bg-slate-50 border border-slate-200 rounded p-1.5 text-center text-xs">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold mb-1 block">ì‹œê³µë‹¨ê°€(ë§Œì›/kW)</label>
                        <input type="number" id="costPerKw" value="120" class="w-full bg-slate-50 border border-slate-200 rounded p-1.5 text-center text-xs">
                    </div>
                </div>
            </div>

            <!-- ë¶„ì„ ê²°ê³¼ ì¹´ë“œ (ì´ˆê¸°ì—” ìˆ¨ê¹€) -->
            <div id="resultCard" class="hidden result-card p-5 rounded-xl shadow-lg text-white space-y-4">
                <div class="flex justify-between items-start border-b border-slate-700 pb-3">
                    <div>
                        <h2 class="text-sm font-bold text-cyan-400 flex items-center gap-1">
                            <i class="ph ph-chart-polar"></i> ë¶„ì„ ë¦¬í¬íŠ¸
                        </h2>
                        <p id="resAddr" class="text-xs text-slate-300 mt-1 break-keep leading-tight">-</p>
                    </div>
                    <span id="resJimok" class="text-[10px] px-2 py-0.5 bg-slate-700 rounded text-slate-300">ì§€ëª©</span>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-slate-400">í•œì „ ì„ ë¡œ ìš©ëŸ‰</span>
                        <span id="resKepco" class="text-sm font-bold text-yellow-400">ì¡°íšŒ ì¤‘...</span>
                    </div>
                    <div class="h-px bg-slate-700"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-[10px] text-slate-400">ì„¤ì¹˜ ê°€ëŠ¥</p>
                            <p class="text-lg font-bold text-white"><span id="resCount">0</span> <span class="text-sm font-normal text-slate-500">ì¥</span></p>
                        </div>
                        <div>
                            <p class="text-[10px] text-slate-400">ì˜ˆìƒ ì„¤ë¹„ìš©ëŸ‰</p>
                            <p class="text-lg font-bold text-cyan-400"><span id="resCap">0</span> <span class="text-sm font-normal text-cyan-700">kW</span></p>
                        </div>
                    </div>
                    <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-700 space-y-1.5">
                        <div class="flex justify-between text-xs">
                            <span class="text-slate-400">ğŸ’° ì—° ì˜ˆìƒ ìˆ˜ìµ</span>
                            <span id="resRev" class="font-bold text-green-400">0 ì›</span>
                        </div>
                        <div class="flex justify-between text-xs">
                            <span class="text-slate-400">ğŸ“‰ íˆ¬ì íšŒìˆ˜(ROI)</span>
                            <span id="resRoi" class="font-bold text-blue-400">0 ë…„</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div id="guideMsg" class="text-center py-10 opacity-60">
                <i class="ph ph-map-trifold text-4xl text-slate-300 mb-2"></i>
                <p class="text-xs text-slate-500">ì§€ë„ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì—¬<br>ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            </div>

            <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
            <div id="loading" class="hidden flex flex-col items-center justify-center py-8">
                <div class="spinner mb-3"></div>
                <p class="text-xs font-bold text-slate-600 animate-pulse">ë°ì´í„° ë¶„ì„ ì¤‘...</p>
                <p class="text-[10px] text-slate-400 mt-1">ì„œë²„ì—ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</p>
            </div>

        </div>

        <!-- í•˜ë‹¨ ë¡œê·¸ì°½ -->
        <div class="h-32 bg-slate-900 border-t border-slate-700 p-3 font-mono text-[10px] overflow-y-auto text-slate-400" id="logWindow">
            <div class="text-green-500">> System Ready.</div>
        </div>
    </div>

    <!-- ê²€ìƒ‰ì°½ (ìƒë‹¨ ìš°ì¸¡) -->
    <div class="absolute top-5 right-5 z-[1000] flex flex-col items-end gap-2">
        <div class="bg-white p-1 rounded-lg shadow-xl border border-slate-200 flex items-center">
            <input type="text" id="addrInput" placeholder="ì£¼ì†Œ ê²€ìƒ‰ (ì˜ˆ: ê°•ë‚¨ëŒ€ë¡œ 123)" 
                   class="w-64 px-3 py-2 text-sm outline-none text-slate-700 font-medium"
                   onkeypress="if(event.key==='Enter') searchAddress()">
            <button onclick="searchAddress()" class="bg-cyan-600 hover:bg-cyan-700 text-white p-2 rounded-md transition shadow-md">
                <i class="ph ph-magnifying-glass font-bold"></i>
            </button>
        </div>
    </div>

    <div id="map"></div>

    <script>
        // 1. ì„œë²„ ì£¼ì†Œ ìë™ ì„¤ì • (ë¡œì»¬ vs ë°°í¬ í™˜ê²½)
        const getApiBase = () => {
            const h = window.location.hostname;
            // ë¡œì»¬ í…ŒìŠ¤íŠ¸(127.0.0.1, localhost)ì´ê±°ë‚˜ íŒŒì¼(file:)ë¡œ ì—´ì—ˆì„ ë• ë¡œì»¬ ì„œë²„(5000)ë¥¼ ë°”ë¼ë´„
            if (h === 'localhost' || h === '127.0.0.1' || window.location.protocol === 'file:') {
                return 'http://localhost:5000'; 
            }
            // Render ë“±ì— ë°°í¬ëì„ ë• ìê¸° ìì‹ (ìƒëŒ€ ê²½ë¡œ) ì‚¬ìš©
            return ''; 
        };
        const API_BASE = getApiBase();

        let map, selectableGroup, panelGroup, activeFeature;

        // V-World ì§€ë„ íƒ€ì¼ í‚¤ (ì§€ë„ ê·¸ë¦¼ë§Œ ê°€ì ¸ì˜¤ëŠ” ìš©ë„ - ê³µê°œí‚¤ ì‚¬ìš© ê°€ëŠ¥)
        const VWORLD_TILE_KEY = "8D526307-78EE-3281-8AB3-0D36115D17C3";

        window.onload = function() {
            initMap();
            log("ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ.");
            log(`Backend ì—°ê²° ì£¼ì†Œ: ${API_BASE || 'Current Origin'}`);
        };

        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([36.5, 127.5], 7);
            
            // ìœ„ì„±ì§€ë„ + í•˜ì´ë¸Œë¦¬ë“œ(ì§€ëª…) ë ˆì´ì–´
            L.tileLayer(`https://api.vworld.kr/req/wmts/1.0.0/${VWORLD_TILE_KEY}/Satellite/{z}/{y}/{x}.jpeg`, { maxZoom: 19 }).addTo(map);
            L.tileLayer(`https://api.vworld.kr/req/wmts/1.0.0/${VWORLD_TILE_KEY}/Hybrid/{z}/{y}/{x}.png`, { maxZoom: 19 }).addTo(map);

            selectableGroup = L.layerGroup().addTo(map);
            panelGroup = L.layerGroup().addTo(map);

            map.on('click', onMapClick);
        }

        // [í•µì‹¬ 1] ì£¼ì†Œ ê²€ìƒ‰ (Backend Proxy ì‚¬ìš©)
        async function searchAddress() {
            const query = document.getElementById('addrInput').value;
            if(!query) return;

            log(`ğŸ” ì£¼ì†Œ ê²€ìƒ‰: ${query}`);
            
            try {
                // ë‚´ ì„œë²„ë¡œ ìš”ì²­ -> ì„œë²„ê°€ V-World API í˜¸ì¶œ -> ê²°ê³¼ ë°˜í™˜
                const res = await fetch(`${API_BASE}/api/vworld/address?address=${encodeURIComponent(query)}`);
                const data = await res.json();
                
                if(data.response && data.response.status === 'OK') {
                    const { x, y } = data.response.result.point;
                    map.setView([y, x], 19);
                    log("ì´ë™ ì™„ë£Œ. ì£¼ë³€ ê±´ë¬¼ ìŠ¤ìº” ì‹œì‘...");
                    scanBuildings(y, x); // ì´ë™ í›„ ìë™ ìŠ¤ìº”
                } else {
                    alert("ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    log("ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨.", "err");
                }
            } catch(e) {
                console.error(e);
                alert("ì„œë²„ í†µì‹  ì‹¤íŒ¨. ë°±ì—”ë“œ(app.py)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");
                log("ì„œë²„ í†µì‹  ì˜¤ë¥˜", "err");
            }
        }

        // [í•µì‹¬ 2] ì§€ë„ í´ë¦­ ì‹œ ê±´ë¬¼ ìŠ¤ìº” (Backend Proxy ì‚¬ìš©)
        function onMapClick(e) {
            scanBuildings(e.latlng.lat, e.latlng.lng);
        }

        async function scanBuildings(lat, lng) {
            selectableGroup.clearLayers();
            panelGroup.clearLayers();
            
            // UI ì´ˆê¸°í™”
            document.getElementById('guideMsg').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultCard').classList.add('hidden');

            const delta = 0.001; // íƒìƒ‰ ë²”ìœ„
            const box = `${lng - delta},${lat - delta},${lng + delta},${lat + delta}`;
            
            try {
                // ë‚´ ì„œë²„ë¡œ ë°ì´í„° ìš”ì²­
                const res = await fetch(`${API_BASE}/api/vworld/data?geomFilter=BOX(${box})`);
                const data = await res.json();

                document.getElementById('loading').classList.add('hidden');

                if(data.response && data.response.status === 'OK') {
                    const features = data.response.result.featureCollection.features;
                    log(`${features.length}ê°œ ê±´ë¬¼ ë°œê²¬.`);
                    
                    L.geoJSON(features, {
                        style: { color: "#38bdf8", weight: 2, fillOpacity: 0.1, dashArray: '4' },
                        onEachFeature: function(feature, layer) {
                            layer.on('click', (e) => {
                                L.DomEvent.stopPropagation(e);
                                analyzeBuilding(feature);
                            });
                        }
                    }).addTo(selectableGroup);
                    
                    // ê°€ì¥ ê°€ê¹Œìš´ ê±´ë¬¼ ìë™ ì„ íƒ
                    if(features.length > 0) {
                        const pt = turf.point([lng, lat]);
                        let nearest = features[0];
                        // ê°„ë‹¨íˆ ì²« ë²ˆì§¸ ìš”ì†Œ ì„ íƒ (ì •ë°€ ë¡œì§ì€ Turf distance ë“± ì‚¬ìš© ê°€ëŠ¥)
                        analyzeBuilding(nearest);
                    }
                } else {
                    log("ì£¼ë³€ì— ê±´ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.", "warn");
                    document.getElementById('guideMsg').classList.remove('hidden');
                    document.getElementById('guideMsg').innerHTML = "<p>ì£¼ë³€ì— ê±´ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.<br>ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•´ë³´ì„¸ìš”.</p>";
                }
            } catch(e) {
                console.error(e);
                log("ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨", "err");
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // [í•µì‹¬ 3] ê±´ë¬¼ ë¶„ì„ ë° íŒ¨ë„ ë°°ì¹˜ (í´ë¼ì´ì–¸íŠ¸ ì—°ì‚° + Backend í•œì „ ì¡°íšŒ)
        async function analyzeBuilding(feature) {
            activeFeature = feature;
            
            // 1. ì„ íƒëœ ê±´ë¬¼ í‘œì‹œ
            selectableGroup.eachLayer(l => l.setStyle({ color: "#38bdf8", weight: 2, fillOpacity: 0.1 }));
            // (ì—¬ê¸°ì„œ í˜„ì¬ ë ˆì´ì–´ë§Œ í•˜ì´ë¼ì´íŠ¸ í•  ìˆ˜ ìˆìŒ)

            // 2. ì •ë³´ í‘œì‹œ
            const props = feature.properties;
            const addr = props.addr || props.road_nm_ad || "ì£¼ì†Œ ì •ë³´ ì—†ìŒ";
            document.getElementById('resAddr').innerText = addr;
            document.getElementById('resJimok').innerText = props.jimok || "ê±´ë¬¼";
            document.getElementById('resultCard').classList.remove('hidden');

            // 3. í•œì „ ìš©ëŸ‰ ì¡°íšŒ (Backend Proxy)
            checkKepco(props.pnu);

            // 4. íŒ¨ë„ ë°°ì¹˜ ì‹œë®¬ë ˆì´ì…˜ (Turf.js - í´ë¼ì´ì–¸íŠ¸ ì—°ì‚°)
            // ì„œë²„ë¡œ ë³´ë‚´ì„œ ê³„ì‚°í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì¦‰ê°ì ì¸ ë°˜ì‘ì„ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìˆ˜í–‰
            simulatePanels(feature);
        }

        async function checkKepco(pnu) {
            const el = document.getElementById('resKepco');
            el.innerText = "ì¡°íšŒ ì¤‘...";
            el.className = "text-sm font-bold text-slate-400 animate-pulse";

            if(!pnu) {
                el.innerText = "PNU ì •ë³´ ì—†ìŒ";
                el.className = "text-sm font-bold text-slate-500";
                return;
            }

            try {
                // ë‚´ ì„œë²„ë¡œ PNU ì „ì†¡
                const res = await fetch(`${API_BASE}/api/kepco?pnu=${pnu}`);
                const data = await res.json();
                
                if(data.response && data.response.body && data.response.body.items) {
                    const item = Array.isArray(data.response.body.items.item) 
                        ? data.response.body.items.item[0] 
                        : data.response.body.items.item;
                    
                    const cap = parseInt(item.ableCapacity);
                    el.innerText = `${cap.toLocaleString()} kW`;
                    el.className = cap > 0 ? "text-sm font-bold text-green-400" : "text-sm font-bold text-red-400";
                    log(`í•œì „ ìš©ëŸ‰ ì¡°íšŒ ì™„ë£Œ: ${cap}kW`);
                } else {
                    el.innerText = "0 kW (ì—¬ìœ  ì—†ìŒ)";
                    el.className = "text-sm font-bold text-red-400";
                }
            } catch(e) {
                console.error(e);
                el.innerText = "ì¡°íšŒ ì‹¤íŒ¨";
                el.className = "text-sm font-bold text-slate-500";
            }
        }

        function simulatePanels(feature) {
            panelGroup.clearLayers();
            
            // íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
            const modPower = parseFloat(document.getElementById('modPower').value) || 640;
            const spacing = parseFloat(document.getElementById('rowSpacing').value) || 1.0;
            
            // ëª¨ë“ˆ í¬ê¸° (ì•½ 1.1m x 2.4m)
            const modW = 1.13; 
            const modH = 2.39; 

            // Turf.jsë¥¼ ì´ìš©í•œ ê²©ì ìƒì„±
            const bbox = turf.bbox(feature);
            const poly = feature.geometry;
            
            // ìœ„ë„ì— ë”°ë¥¸ ë¯¸í„° í™˜ì‚°
            const lat = (bbox[1] + bbox[3]) / 2;
            const mPerDegLat = 111132;
            const mPerDegLng = 111320 * Math.cos(lat * (Math.PI / 180));
            
            const wDeg = modW / mPerDegLng;
            const hDeg = modH / mPerDegLat;
            const sDeg = spacing / mPerDegLat;

            let panels = [];
            
            // ë‹¨ìˆœ ê²©ì ë°°ì¹˜ ì•Œê³ ë¦¬ì¦˜
            for (let y = bbox[1]; y < bbox[3]; y += (hDeg + sDeg)) {
                for (let x = bbox[0]; x < bbox[2]; x += (wDeg + 0.000005)) {
                    const cell = turf.polygon([[
                        [x, y],
                        [x + wDeg, y],
                        [x + wDeg, y + hDeg],
                        [x, y + hDeg],
                        [x, y]
                    ]]);
                    
                    // ê±´ë¬¼ ì•ˆì— ì™„ì „íˆ ë“¤ì–´ê°€ëŠ”ì§€ í™•ì¸
                    const center = turf.centroid(cell);
                    if (turf.booleanPointInPolygon(center, feature)) {
                        panels.push(cell);
                    }
                }
            }

            // ì‹œê°í™”
            if(panels.length > 0) {
                L.geoJSON({type: "FeatureCollection", features: panels}, {
                    style: { color: '#3b82f6', weight: 1, fillColor: '#2563eb', fillOpacity: 0.8 }
                }).addTo(panelGroup);
            }

            // ê²°ê³¼ ê³„ì‚°
            const count = panels.length;
            const capKw = (count * modPower) / 1000;
            
            // ìˆ˜ìµ ê³„ì‚° (ì•½ì‹)
            const smp = parseFloat(document.getElementById('smp').value);
            const costPerKw = parseFloat(document.getElementById('costPerKw').value) * 10000;
            
            const annualGen = capKw * 3.6 * 365; // ì—° ë°œì „ëŸ‰ (3.6ì‹œê°„ ê¸°ì¤€)
            const annualRev = annualGen * smp;
            const totalCost = capKw * costPerKw;
            const roi = annualRev > 0 ? (totalCost / annualRev).toFixed(1) : 0;

            // UI ì—…ë°ì´íŠ¸
            animateValue('resCount', count);
            animateValue('resCap', capKw.toFixed(1));
            document.getElementById('resRev').innerText = Math.round(annualRev/10000).toLocaleString() + " ë§Œì›";
            document.getElementById('resRoi').innerText = roi + " ë…„";

            log(`ë°°ì¹˜ ì™„ë£Œ: ${count}ì¥, ${capKw.toFixed(1)}kW`);
        }

        function animateValue(id, end) {
            const obj = document.getElementById(id);
            obj.innerText = end;
            obj.classList.remove('text-white');
            obj.classList.add('text-yellow-300');
            setTimeout(() => {
                obj.classList.remove('text-yellow-300');
                obj.classList.add('text-white'); // or original color
            }, 300);
        }

        function log(msg, type='info') {
            const win = document.getElementById('logWindow');
            const color = type === 'err' ? 'text-red-400' : (type === 'warn' ? 'text-yellow-400' : 'text-slate-400');
            win.innerHTML += `<div class="${color}">> ${msg}</div>`;
            win.scrollTop = win.scrollHeight;
        }
    </script>
</body>
</html>
